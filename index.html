<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Zoom en tu comunidad</title>

  <!-- Styles for Zoom SDK -->
  <link
    type="text/css"
    rel="stylesheet"
    href="https://source.zoom.us/2.14.0/css/bootstrap.css"
  />
  <link
    type="text/css"
    rel="stylesheet"
    href="https://source.zoom.us/2.14.0/css/react-select.css"
  />

  <!-- Zoom Meeting SDK and its dependencies -->
  <script src="https://source.zoom.us/2.14.0/lib/vendor/react.min.js"></script>
  <script src="https://source.zoom.us/2.14.0/lib/vendor/react-dom.min.js"></script>
  <script src="https://source.zoom.us/2.14.0/zoom-meeting-2.14.0.min.js"></script>

  <style>
    html, body { margin:0; padding:0; height:100%; }
    #zoomContainer { position:relative; width:100%; height:100%; }
    .zoom-btn {
      position:absolute; top:8px; padding:0.5rem 1rem;
      border:none; border-radius:4px; background:rgba(0,0,0,0.6);
      color:white; cursor:pointer; z-index:10;
    }
    #enterFs { right:8px; }
    #exitFs  { right:8px; display:none; }
  </style>
</head>
<body>
  <div id="zoomContainer"></div>
  <button id="enterFs" class="zoom-btn">üñ•Ô∏è Entrar pantalla completa</button>
  <button id="exitFs" class="zoom-btn">‚ùå Salir pantalla completa</button>

  <script>
    ZoomMtg.setZoomJSLib('https://source.zoom.us/2.14.0/lib', '/av');
    ZoomMtg.preLoadWasm();
    ZoomMtg.prepareWebSDK();

    const meetConfig = {
      apiKey: 'I4k75wP6QKWINI3BA9Cw2Q',
      meetingNumber: '84741182849',
      userName: 'Participante',
      passWord: '',
      role: 0,
      leaveUrl: window.location.href
    };

    // Llama a tu endpoint de Replit para obtener la firma
    fetch('https://f4694874-9d0f-4ec8-bca7-9a78ceab281f-00-13svxwdokjyyl.riker.replit.dev/signature', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        meetingNumber: meetConfig.meetingNumber,
        role: meetConfig.role
      })
    })
    .then(res => res.json())
    .then(({ signature }) => {
      ZoomMtg.init({
        leaveUrl: meetConfig.leaveUrl,
        isSupportAV: true,
        success: () => {
          ZoomMtg.join({
            signature,
            sdkKey: meetConfig.apiKey,
            meetingNumber: meetConfig.meetingNumber,
            userName: meetConfig.userName,
            passWord: meetConfig.passWord,
            success: () => console.log('Unido a Zoom'),
            error: (e) => console.error(e)
          });
        }
      });
    });

    // Botones de fullscreen
    const container = document.getElementById('zoomContainer'),
          btnEnter  = document.getElementById('enterFs'),
          btnExit   = document.getElementById('exitFs');
    btnEnter.onclick = () =>
      container.requestFullscreen?.() ||
      container.webkitRequestFullscreen?.() ||
      container.msRequestFullscreen?.();
    btnExit.onclick  = () =>
      document.exitFullscreen?.() ||
      document.webkitExitFullscreen?.() ||
      document.msExitFullscreen?.();
    document.addEventListener('fullscreenchange', () => {
      const inFs = document.fullscreenElement === container;
      btnEnter.style.display = inFs ? 'none' : 'block';
      btnExit .style.display = inFs ? 'block' : 'none';
    });
  </script>
</body>
</html>
