<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Zoom en tu comunidad</title>

  <!-- 1. CSS requeridos por el SDK -->
  <link rel="stylesheet" href="https://source.zoom.us/2.14.0/css/bootstrap.css" />
  <link rel="stylesheet" href="https://source.zoom.us/2.14.0/css/react-select.css" />

  <!-- 2. Dependencias globales en el orden correcto -->
  <script src="https://source.zoom.us/2.14.0/lib/vendor/react.min.js"></script>
  <script src="https://source.zoom.us/2.14.0/lib/vendor/react-dom.min.js"></script>
  <script src="https://source.zoom.us/2.14.0/lib/vendor/redux.min.js"></script>
  <script src="https://source.zoom.us/2.14.0/lib/vendor/redux-thunk.min.js"></script>

  <!-- 3. SDK de Zoom -->
  <script src="https://source.zoom.us/2.14.0/zoom-meeting-2.14.0.min.js"></script>

  <style>
    html, body { margin:0; padding:0; height:100%; }
    #zoomContainer { position:relative; width:100%; height:100%; }
    .zoom-btn {
      position:absolute; top:8px; padding:0.5rem 1rem;
      border:none; border-radius:4px; background:rgba(0,0,0,0.6);
      color:white; cursor:pointer; z-index:10;
    }
    #enterFs { right:8px; }
    #exitFs  { right:8px; display:none; }
  </style>
</head>
<body>
  <div id="zoomContainer"></div>
  <button id="enterFs" class="zoom-btn">üñ•Ô∏è Entrar pantalla completa</button>
  <button id="exitFs" class="zoom-btn">‚ùå Salir pantalla completa</button>

  <script>
    // 1. Inicializamos el SDK
    ZoomMtg.setZoomJSLib('https://source.zoom.us/2.14.0/lib', '/av');
    ZoomMtg.preLoadWasm();
    ZoomMtg.prepareWebSDK();

    // 2. Datos de la reuni√≥n
    const meetConfig = {
      apiKey: 'I4k75wP6QKWINI3BA9Cw2Q',
      meetingNumber: '84741182849',
      userName: 'Participante',
      passWord: '',
      role: 0,
      leaveUrl: window.location.href
    };

    // 3. Solicitamos la firma JWT al backend
    fetch('https://f4694874-9d0f-4ec8-bca7-9a78ceab281f-00-13svxwdokjyyl.riker.replit.dev/signature', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        meetingNumber: meetConfig.meetingNumber,
        role: meetConfig.role
      })
    })
    .then(res => res.json())
    .then(({ signature }) => {
      // 4. Inicializar reuni√≥n
      ZoomMtg.init({
        leaveUrl: meetConfig.leaveUrl,
        isSupportAV: true,
        success: () => {
          console.log('‚úÖ init success');
          ZoomMtg.join({
            signature,
            sdkKey: meetConfig.apiKey,
            meetingNumber: meetConfig.meetingNumber,
            userName: meetConfig.userName,
            passWord: meetConfig.passWord,
            success: () => console.log('‚úÖ join success'),
            error: err => console.error('‚ùå join error', err)
          });
        },
        error: err => console.error('‚ùå init error', err)
      });
    })
    .catch(err => console.error('‚ùå fetch signature error', err));

    // 5. Controles de pantalla completa
    const container = document.getElementById('zoomContainer');
    const btnEnter  = document.getElementById('enterFs');
    const btnExit   = document.getElementById('exitFs');

    btnEnter.onclick = () =>
      container.requestFullscreen?.() ||
      container.webkitRequestFullscreen?.() ||
      container.msRequestFullscreen?.();

    btnExit.onclick = () =>
      document.exitFullscreen?.() ||
      document.webkitExitFullscreen?.() ||
      document.msExitFullscreen?.();

    document.addEventListener('fullscreenchange', () => {
      const inFs = document.fullscreenElement === container;
      btnEnter.style.display = inFs ? 'none' : 'block';
      btnExit.style.display = inFs ? 'block' : 'none';
    });
  </script>
</body>
</html>
